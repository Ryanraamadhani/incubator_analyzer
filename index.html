<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Incubator Analyzer</title>

  <style>
    * {margin:0;padding:0;box-sizing:border-box;font-family:"Poppins",sans-serif;}
    body {
      background: linear-gradient(135deg,#2563eb,#4f46e5);
      display:flex;align-items:center;justify-content:center;
      padding:20px;min-height:100vh;color:#fff;
    }
    .card {
      width:100%;max-width:450px;background:white;color:#333;
      padding:30px;border-radius:18px;box-shadow:0 10px 25px rgba(0,0,0,0.2);
      text-align:center;
    }
    h1 {font-size:26px;margin-bottom:8px;color:#2563eb;}
    .sensor-box {
      display:flex;justify-content:space-between;
      padding:20px;background:#f3f4f6;border-radius:12px;
      margin-bottom:10px;font-size:18px;font-weight:500;
    }
    .label {color:#374151;}
    .value {color:#2563eb;font-weight:bold;}
    button {
      margin-top:15px;padding:12px 18px;border:none;
      background:#2563eb;color:white;border-radius:8px;
      cursor:pointer;font-size:15px;
    }
    button:hover {opacity:0.9;}
    footer {font-size:12px;margin-top:25px;color:#666;}
  </style>
</head>
<body>

<div class="card">
  <h1>ðŸŸ¢ Incubator Analyzer</h1>
  <p>Pengawas suhu & kelembaban realtime</p>

  <div class="sensor-box">
    <span class="label">Suhu:</span>
    <span id="suhu" class="value">-- Â°C</span>
  </div>

  <div class="sensor-box">
    <span class="label">Kelembaban:</span>
    <span id="kelembaban" class="value">-- %</span>
  </div>

  <button onclick="downloadCSV()">Download CSV</button>
  <footer>Â© 2025 IoT Incubator Monitor</footer>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "GANTI",
  authDomain: "GANTI",
  databaseURL: "GANTI",
  projectId: "GANTI",
  storageBucket: "GANTI",
  messagingSenderId: "GANTI",
  appId: "GANTI"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Simpan log CSV
let logData = [];

// Realtime suhu
db.ref("incubator/suhu").on("value", snap => {
  const suhu = snap.val();
  const waktu = new Date().toLocaleString();
  document.getElementById("suhu").innerText = suhu + " Â°C";

  logData.push({ waktu, suhu });
});

// Realtime kelembaban
db.ref("incubator/kelembaban").on("value", snap => {
  const kelembaban = snap.val();
  const waktu = new Date().toLocaleString();
  document.getElementById("kelembaban").innerText = kelembaban + " %";

  if (logData.length > 0) {
    logData[logData.length - 1].kelembaban = kelembaban;
  }
});

// Download CSV
function downloadCSV() {
  let csv = "waktu,suhu,kelembaban\n";
  logData.forEach(r => {
    csv += `${r.waktu},${r.suhu || ""},${r.kelembaban || ""}\n`;
  });

  const blob = new Blob([csv], { type: "text/csv" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "data_incubator.csv";
  a.click();
}
</script>

</body>
</html>
